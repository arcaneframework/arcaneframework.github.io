<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arcane: Analyse de performances par échantillonage</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Arcane
   &#160;<span id="projectnumber">3.5.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Généré par Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Recherche');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d6/dff/arcanedoc_profiling.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Analyse de performances par échantillonage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section warning"><dt>Avertissement</dt><dd>Actuellement, le profiling ne fonctionne que sur les plateformes Linux.</dd>
<dd>
Actuellement, le profiling NE FONCTIONNE PAS lorsque le multi-threading (que ce soit avec le mécanisme des tâches ou d'échange de message) est actif.</dd></dl>
<p>Le profiling dans Arcane fonctionne sur un principe d'échantillonage: à interval régulier, le code est interrompu et on regarde dans quelle méthode on se trouve. Si l'interval d'échantillonage est petit et si le code est exécuté pendant suffisamment longtemps, on obtient une bonne représentation statistique de la proportion de temps passé dans les méthodes les plus couteuses. Les méthodes par échantillonage ne nécessitent pas l'instrumentation du code et donc ralentissent très peu l'éxecution. Par contre, elles ne permettent pas de savoir par exemple combien de fois une méthode est appelée, ni de connaitre facilement le graphe d'appel. Pour cela, il est nécessaire d'utiliser des mécanismes comme gprof avec le suppport du compilateur.</p>
<p>Pour activer le profiling, il faut positionner la variable d'environnement ARCANE_PROFILING avec une des valeurs suivantes:</p><ul>
<li><em>Prof</em> . Cela permet d'avoir un profiling peu précis mais qui fonctionne sur toutes les machines Linux. L'échantillonage est d'une fréquence de l'ordre de 20Hz et donc il faut faire tourner le code au moins 1 minutes pour avoir des résultats significatifs</li>
<li><em>Papi</em>. Cela permet d'avoir un profiling très précis, utilisant les compteurs hardware du processeur. On utilise pour cela la bibliothèque libre PAPI. Cela ne fonctionne qu'avec les noyaus Linux récents (2.6.32 ou +) ou les noyaux patchés et il faut que Arcane soit compilé avec ce support. Dans ce mode l'échantillonage est donnée en nombre de cycle d'horloge du processeur. La valeur par défaut est de 500000 cycles. Pour un processeur à 3GHz, cela fait donc 6000 échantillons par seconde. Il est possible de changer le nombre de cycles via la variable d'environnement ARCANE_PROFILING_PERIOD. Il est préférable de ne pas descendre en dessous de la valeur par défaut.</li>
</ul>
<p>Afin de garder des performances raisonnables lors de l'exécution, il est préférable de ne pas dépasser 100000 échantillons. Il faut donc ajuster la durée d'exécution du test ou la fréquence d'échantillonage en fonction de cela.</p>
<p>Lorsqu'il est actif, le profiling commence à la première itération et s'arrête à la dernière itération de l'exécution. En parallèle, le profiling se fait pour chaque processeur et Arcane affiche alors dans le listing de chaque processeur les informations de profiling de la manière suivante:</p>
<pre class="fragment">*I-Internal    PROCESS_ID = 17977
*I-Internal    NB ADDRESS MAP = 737
*I-Internal    NB FUNC MAP = 53
*I-Internal    NB STACK MAP = 0
*I-Internal    TOTAL STACK = 0
*I-Internal    FUNC EVENT=2798
*I-Internal    FUNC FP=0
*I-Internal    TOTAL EVENT  = 2799
*I-Internal    TOTAL FP     = 1 (nb_giga_flip=0.0005)
*I-Internal    RATIO FP/CYC = 0.000357270453733476
*I-Internal    event     %   function
*I-Internal      1113   39.7      1113      0      0 0  SimpleHydro::ModuleSimpleHydro::computeCQs(Arcane::Real3*, Arcane::Real3*, Arcane::Cell const&amp;)
*I-Internal       613   21.9       613      0      0 0  SimpleHydro::ModuleSimpleHydro::_computeGeometricValues(Arcane::ItemVectorViewT&lt;Arcane::Cell&gt;)
*I-Internal       396   14.1       396      0      0 0  SimpleHydro::ModuleSimpleHydro::_computePressureAndCellPseudoViscosityForces()
*I-Internal       217    7.7       217      0      0 0  SimpleHydro::ModuleSimpleHydro::_applyEquationOfState(Arcane::ItemVectorViewT&lt;Arcane::Cell&gt;)
*I-Internal        87    3.1        87      0      0 0  SimpleHydro::ModuleSimpleHydro::applyBoundaryCondition()
*I-Internal        85    3.0        85      0      0 0  SimpleHydro::ModuleSimpleHydro::_computeViscosityWork(Arcane::ItemVectorViewT&lt;Arcane::Cell&gt;)
*I-Internal        77    2.7        77      0      0 0  SimpleHydro::ModuleSimpleHydro::updateDensity()
*I-Internal        70    2.5        70      0      0 0  SimpleHydro::ModuleSimpleHydro::computeVelocity()
*I-Internal        50    1.7        50      0      0 0  SimpleHydro::ModuleSimpleHydro::computeDeltaT()
*I-Internal        28    1.0        28      0      0 0  SimpleHydro::ModuleSimpleHydro::moveNodes()
*I-Internal        13    0.4        13      0      0 0  Arcane::VariableArrayT&lt;Arcane::Real3&gt;::fill(Arcane::Real3 const&amp;, Arcane::ItemGroup const&amp;)
*I-Internal         4    0.1         4      0      0 0  _IO_vfprintf
*I-Internal         2    0.0         2      0      0 0  Arcane::Timer::Sentry::~Sentry()
*I-Internal         1    0.0         1      0      0 0  SimpleHydro::ModuleSimpleHydro::applyEquationOfState()
</pre><p>Les premières lignes sont des informations internes à Arcane. Ensuite, est affiché, par ordre décroissant du temps passé, chaque méthode. Dans l'exemple précédent, on voit qu'on passe 39.7% du temps dans la méthode ModuleSimpleHydro::computeCQs().</p>
<p>Pour que les résultats soient pertinents, il faut que le code soit compilé en mode optimisé avec l'inlining activé. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">%Arcane</a></li><li class="navelem"><a class="el" href="../../db/df9/arcanedoc_profiling_toc.html">Analyse de performances (&lt;em&gt;Profiling&lt;/em&gt;)</a></li>
    <li class="footer">Généré le Lundi 4 Avril 2022 03:01:30 pour Arcane par
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
