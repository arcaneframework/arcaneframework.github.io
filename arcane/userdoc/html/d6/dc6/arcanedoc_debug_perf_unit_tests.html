<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.6" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Arcane: Le support des tests unitaires dans Arcane</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-custom.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../user_colors.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
    <script type="text/javascript" src="../../script-helper.js"></script>
    <script type="text/javascript" src="../../script-resize.js"></script>
    <script type="text/javascript" src="../../script-num-lines-code.js"></script>
    <script type="text/javascript" src="../../script-config-theme.js"></script>
    <script type="text/javascript" src="../../script-edit-config-theme.js"></script>
    <script type="text/javascript" src="../../script-alternative-theme.js"></script>
    <script type="text/javascript">
      // On demande l'activation de la personnalisation de la page.
      var no_custom_theme = false;
      DoxygenAwesomeDarkModeToggle.title = "Thème clair/sombre";
      DoxygenAwesomeDarkModeToggle.init();
      DoxygenAwesomeFragmentCopyButton.title = "Copier le code dans le presse-papier";
      DoxygenAwesomeFragmentCopyButton.init();
      DoxygenAwesomeParagraphLink.init();
      DoxygenAwesomeInteractiveToc.init();
      DoxygenAwesomeTabs.init()
      waitElemForResizeSideNav();
      setOldSize();
      //waitItemExpandCurrent();
    </script>
  </head>
  <body>
    <!--BEGIN CORNER_GITHUB-->
    <!-- https://tholman.com/github-corners/ -->
    <a href="https://github.com/arcaneframework/framework" class="github-corner" aria-label="Voir les sources sur GitHub">
      <svg width="70" height="70" viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <!--END CORNER_GITHUB-->
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectlogo">
                  <a href="../../index.html" title="Aller à la page principale">
                    <img alt="Logo" src="../../arcane_logo.webp" />
                  </a>
                </td>
              </tr>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">Arcane
                    <span id="projectnumber">&#160;v3.12.9.0</span>
                  </div>
                  <div id="projectbrief">Documentation utilisateur</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Généré par Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/dc6/arcanedoc_debug_perf_unit_tests.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Chargement...</div>
<div class="SRStatus" id="Searching">Recherche...</div>
<div class="SRStatus" id="NoMatches">Aucune correspondance</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Le support des tests unitaires dans Arcane </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table des matières</h3>
<ul><li class="level1"><a href="#arcanedoc_debug_perf_unit_tests_intro">Introduction</a></li>
<li class="level1"><a href="#arcanedoc_debug_perf_unit_tests_decl">Déclaration des tests</a></li>
<li class="level1"><a href="#arcanedoc_debug_perf_unit_tests_assertions">Les assertions</a><ul><li class="level2"><a href="#arcanedoc_debug_perf_unit_tests_parallel">Tests unitaires en parallèle</a></li>
<li class="level2"><a href="#arcanedoc_debug_perf_unit_tests_exception">Cas particulier des exceptions</a></li>
</ul>
</li>
<li class="level1"><a href="#arcanedoc_debug_perf_unit_tests_data">Le fichier de données</a></li>
<li class="level1"><a href="#arcanedoc_debug_perf_unit_tests_run">L&#39;exécution</a></li>
<li class="level1"><a href="#arcanedoc_debug_perf_unit_tests_own_timeloop">Utiliser sa propre boucle en temps</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_doc_doc_user_chap_debug_perf_4_unit_tests"></a></p>
<h1><a class="anchor" id="arcanedoc_debug_perf_unit_tests_intro"></a>
Introduction</h1>
<p>Les tests unitaires dans Arcane sont exécutés sans que la simulation ne soit lancée. Ils permettent de tester des services, pas des modules. Leur mise en oeuvre est simple et rapide : les services déclarent des méthodes de test dans le descripteur (fichier '.axl'). Ces méthodes sont exécutées par un module de test et une boucle en temps dédiés qui sont fournis par Arcane. Il suffit, pour exécuter les tests, d'ajouter le service à la liste des services du module de test.</p>
<p>Cette page décrit les différentes étapes à suivre pour construire et exécuter des tests unitaires. Notons, qu'à ce jour, les tests unitaires ne fonctionnent qu'en séquentiel. La génération du rapport de test n'est pas encore implémentée en parallèle.</p>
<h1><a class="anchor" id="arcanedoc_debug_perf_unit_tests_decl"></a>
Déclaration des tests</h1>
<p>Les tests unitaires peuvent être ajoutés à n'importe quel service. Il suffit pour cela de déclarer les méthodes de test dans le descripteur du service (fichier 'axl') sous la forme suivante :</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">tests</span> <span class="keyword">class-set-up</span>=<span class="stringliteral">&quot;setUpForClass&quot;</span> <span class="keyword">test-set-up</span>=<span class="stringliteral">&quot;setUp&quot;</span> <span class="keyword">class-tear-down</span>=<span class="stringliteral">&quot;tearDownForClass&quot;</span> <span class="keyword">test-tear-down</span>=<span class="stringliteral">&quot;tearDown&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">test</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Test 1&quot;</span> <span class="keyword">method-name</span>=<span class="stringliteral">&quot;myTestMethod1&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">test</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Test 2&quot;</span> <span class="keyword">method-name</span>=<span class="stringliteral">&quot;myTestMethod2&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">test</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Test 3&quot;</span> <span class="keyword">method-name</span>=<span class="stringliteral">&quot;myTestMethod3&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">tests</span>&gt; </div>
</div><!-- fragment --><p>Le descripteur ci-dessus déclare :</p>
<ul>
<li>3 méthodes de test 'myTestMethod1', 'myTestMethod2' et 'myTestMethod3'. Ces 3 tests comportent un nom (attribut 'name') qui est utilisé pour les affichages lors de l'exécution du test.</li>
<li>2 méthodes optionnelles 'setUp' et 'tearDown' qui sont appelées respectivement avant et après chaque appel à une méthode de test. Si n méthodes de test sont déclarées, 'setUp' et 'tearDown' sont donc appelées n fois. Notons qu'il est tout à fait possible de ne déclarer que le setUp ou que le tearDown.</li>
<li>2 méthodes optionnelles 'setUpForClass' et 'tearDownForClass' qui sont appelées respectivement avant et après l'exécution de l'ensemble des méthodes déclarées dans le descripteur. Quel que soit le nombre de méthodes déclarées, 'setUpForClass' et 'tearDownForClass' ne sont donc appelées qu'une seule fois.</li>
</ul>
<p>Une fois ce travail effectué, il vous reste à écrire les méthodes déclarées dans le descripteur dans votre code du service. Pour l'exemple précédent, on obtient pour le fichier '.h' :</p>
<div class="fragment"><div class="line"> ...</div>
<div class="line">public:</div>
<div class="line"> <span class="keywordtype">void</span> setUpForClass();</div>
<div class="line"> <span class="keywordtype">void</span> tearDownForClass();</div>
<div class="line"> <span class="keywordtype">void</span> setUp();</div>
<div class="line"> <span class="keywordtype">void</span> tearDown();</div>
<div class="line"> <span class="keywordtype">void</span> myTestMethod1();</div>
<div class="line"> <span class="keywordtype">void</span> myTestMethod2();</div>
<div class="line"> <span class="keywordtype">void</span> myTestMethod3();</div>
<div class="line"> ...</div>
</div><!-- fragment --><p>Néanmoins, si vous oubliez de définir une des méthodes dans votre '.h', une erreur de compilation se produira. Dans l'exemple précédent, si vous oubliez de définir 'myTestMethod1', vous obtiendrez le message suivant :</p>
<div class="fragment"><div class="line">error: no &#39;void MonServiceDeTest::myTestMethod1()&#39; member function declared in class &#39;MonServiceDeTest&#39;</div>
</div><!-- fragment --><h1><a class="anchor" id="arcanedoc_debug_perf_unit_tests_assertions"></a>
Les assertions</h1>
<p>Il faut maintenant coder les méthodes de test. Comme pour la plupart des bibliothèques de tests unitaires (CppUnit, GoogleTest...), Arcane met à disposition un ensemble d'assertions pour tester les résultats de tests. Ces assertions sont disponibles sous forme de macros C++.</p>
<p>`A ce jour, les macros disponibles sont :</p>
<ul>
<li>FAIL : qui permet de faire échouer un test. Cette macro est utile, par exemple, pour vérifier qu'une exception est appelée. Il suffit de faire un appel à FAIL après l'instruction qui doit déclencher l'exception. Si l'exception n'est pas déclenchée, l'instruction suivante est exécutée et FAIL est appelée.</li>
<li><a class="el" href="../../d8/d6c/Assertion_8h.html#ae9244bfbda562e8b798789b001993fa5" title="Vérifie que condition est vrai.">ASSERT_TRUE(condition)</a> : qui permet de vérifier qu'une valeur booleéenne est vraie. Par exemple, <a class="el" href="../../d8/d6c/Assertion_8h.html#ae9244bfbda562e8b798789b001993fa5" title="Vérifie que condition est vrai.">ASSERT_TRUE(i&lt;5)</a>.</li>
<li><a class="el" href="../../d8/d6c/Assertion_8h.html#a8197fa52f3538588d20d8af4834c9003" title="Vérifie que condition est faux.">ASSERT_FALSE(condition)</a> : assertion inverse à la précédente.</li>
<li><a class="el" href="../../d8/d6c/Assertion_8h.html#ac80ccfa08e0e798d3b930c75a105a462" title="Vérifie que expected et actual sont égaux. La comparaison se fait via l&#39;opérator==() du type.">ASSERT_EQUAL(expected, actual)</a> : permet de vérifier l'égalité entre la valeur attendue pour le test et le résultat effectivement obtenu. Cette macro s'appuie sur une méthode générique (template) qui utilise l'opérateur '=='. Cette macro est donc valable pour tout type définissant cet opérateur. Notons que les types de base de <a class="el" href="../../d0/d32/namespaceArcane.html" title="-*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-">Arcane</a> répondent à cette exigence (Integer, Real, Real2...).</li>
<li><a class="el" href="../../d8/d6c/Assertion_8h.html#af8734d456be225d2489ee2d6cb295bfd" title="Vérifie que expected et actual sont presques égaux.">ASSERT_NEARLY_EQUAL(expected, actual)</a> : permet de vérifier la 'presque' égalité entre la valeur attendue pour le test et le résultat effectivement obtenu. Cette assertion est utile pour tester l'égalité entre des réels malgré les imprécisions machine. Cette macro s'appuie sur une méthode générique (template) qui utilise la méthode 'math::isNearlyEqual'. Cette macro est donc valable pour tout type définissant cette méthode. C'est le cas des réels <a class="el" href="../../d0/d32/namespaceArcane.html" title="-*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-">Arcane</a>.</li>
<li><a class="el" href="../../d8/d6c/Assertion_8h.html#afd226591e43b77c4e9085e5e2dd7e974" title="Vérifie que expected et actual sont presques égaux.">ASSERT_NEARLY_EQUAL_EPSILON(expected, actual, epsilon)</a> : fonctionne comme l'assertion précédente avec un epsilon de comparaison fourni en paramètre par l'appelant.</li>
</ul>
<p>Voici quelques exemples d'utilisation de ces macros :</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="../../d8/d6c/Assertion_8h.html#ae9244bfbda562e8b798789b001993fa5">ASSERT_TRUE</a>(i &lt;= 5);</div>
<div class="line"><a class="code hl_define" href="../../d8/d6c/Assertion_8h.html#a8197fa52f3538588d20d8af4834c9003">ASSERT_FALSE</a>(i &gt; 5);</div>
<div class="line"><a class="code hl_define" href="../../d8/d6c/Assertion_8h.html#ac80ccfa08e0e798d3b930c75a105a462">ASSERT_EQUAL</a>(5, x);</div>
<div class="line"><a class="code hl_define" href="../../d8/d6c/Assertion_8h.html#af8734d456be225d2489ee2d6cb295bfd">ASSERT_NEARLY_EQUAL</a>(5.5, y);</div>
<div class="ttc" id="aAssertion_8h_html_a8197fa52f3538588d20d8af4834c9003"><div class="ttname"><a href="../../d8/d6c/Assertion_8h.html#a8197fa52f3538588d20d8af4834c9003">ASSERT_FALSE</a></div><div class="ttdeci">#define ASSERT_FALSE(condition)</div><div class="ttdoc">Vérifie que condition est faux.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6c/Assertion_8h_source.html#l00138">Assertion.h:138</a></div></div>
<div class="ttc" id="aAssertion_8h_html_ac80ccfa08e0e798d3b930c75a105a462"><div class="ttname"><a href="../../d8/d6c/Assertion_8h.html#ac80ccfa08e0e798d3b930c75a105a462">ASSERT_EQUAL</a></div><div class="ttdeci">#define ASSERT_EQUAL(expected, actual)</div><div class="ttdoc">Vérifie que expected et actual sont égaux. La comparaison se fait via l'opérator==() du type.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6c/Assertion_8h_source.html#l00151">Assertion.h:151</a></div></div>
<div class="ttc" id="aAssertion_8h_html_ae9244bfbda562e8b798789b001993fa5"><div class="ttname"><a href="../../d8/d6c/Assertion_8h.html#ae9244bfbda562e8b798789b001993fa5">ASSERT_TRUE</a></div><div class="ttdeci">#define ASSERT_TRUE(condition)</div><div class="ttdoc">Vérifie que condition est vrai.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6c/Assertion_8h_source.html#l00126">Assertion.h:126</a></div></div>
<div class="ttc" id="aAssertion_8h_html_af8734d456be225d2489ee2d6cb295bfd"><div class="ttname"><a href="../../d8/d6c/Assertion_8h.html#af8734d456be225d2489ee2d6cb295bfd">ASSERT_NEARLY_EQUAL</a></div><div class="ttdeci">#define ASSERT_NEARLY_EQUAL(expected, actual)</div><div class="ttdoc">Vérifie que expected et actual sont presques égaux.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6c/Assertion_8h_source.html#l00165">Assertion.h:165</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="arcanedoc_debug_perf_unit_tests_parallel"></a>
Tests unitaires en parallèle</h2>
<p>Depuis la version 2.20 de Arcane, il est possible d'utiliser les tests unitaires en parallèle. Pour cela, une version des macros est disponible en spécifiant en paramètre une instance de <a class="el" href="../../dc/d5a/classArcane_1_1IParallelMng.html" title="Interface du gestionnaire de parallélisme pour un sous-domaine.">Arcane::IParallelMng</a>. Ces macros sont identiques dans leurs sémantiques à la version séquentielle et sont préfixées par <code>PARALLEL_</code>, comme par exemple PARALLEL_ASSERT_TRUE ou PARALLEL_ASSERT_NEARLY_EQUAL. Ces appels sont collectifs et le test est considéré comme ayant échoué si un des rangs a échoué.</p>
<p>Voici un exemple d'utilisation :</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d32/namespaceArcane.html">Arcane</a>;</div>
<div class="line"><a class="code hl_class" href="../../dc/d5a/classArcane_1_1IParallelMng.html">IParallelMng</a>* pm = ...;</div>
<div class="line"><a class="code hl_typedef" href="../../d5/d60/namespaceArccore.html#a186895d3c679e34cffb1ecf0db5c3aaa">Real</a> deltat = ...;</div>
<div class="line"><a class="code hl_define" href="../../d8/d6c/Assertion_8h.html#a27ff66e8b4578d6ad874fd9b4dafee1d">PARALLEL_ASSERT_NEARLY_EQUAL</a>(deltat,1.0,pm);</div>
<div class="ttc" id="aAssertion_8h_html_a27ff66e8b4578d6ad874fd9b4dafee1d"><div class="ttname"><a href="../../d8/d6c/Assertion_8h.html#a27ff66e8b4578d6ad874fd9b4dafee1d">PARALLEL_ASSERT_NEARLY_EQUAL</a></div><div class="ttdeci">#define PARALLEL_ASSERT_NEARLY_EQUAL(expected, actual, parallel_mng)</div><div class="ttdoc">Vérifie que expected et actual sont presques égaux.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6c/Assertion_8h_source.html#l00172">Assertion.h:172</a></div></div>
<div class="ttc" id="aclassArcane_1_1IParallelMng_html"><div class="ttname"><a href="../../dc/d5a/classArcane_1_1IParallelMng.html">Arcane::IParallelMng</a></div><div class="ttdoc">Interface du gestionnaire de parallélisme pour un sous-domaine.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d03/IParallelMng_8h_source.html#l00051">IParallelMng.h:52</a></div></div>
<div class="ttc" id="anamespaceArcane_html"><div class="ttname"><a href="../../d0/d32/namespaceArcane.html">Arcane</a></div><div class="ttdoc">-*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-</div><div class="ttdef"><b>Definition:</b> <a href="../../de/df4/AbstractCaseDocumentVisitor_8cc_source.html#l00020">AbstractCaseDocumentVisitor.cc:20</a></div></div>
<div class="ttc" id="anamespaceArccore_html_a186895d3c679e34cffb1ecf0db5c3aaa"><div class="ttname"><a href="../../d5/d60/namespaceArccore.html#a186895d3c679e34cffb1ecf0db5c3aaa">Arccore::Real</a></div><div class="ttdeci">double Real</div><div class="ttdoc">Type représentant un réel.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d76/ArccoreGlobal_8h_source.html#l00218">ArccoreGlobal.h:218</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="arcanedoc_debug_perf_unit_tests_exception"></a>
Cas particulier des exceptions</h2>
<p>Parfois, on souhaite développer un test unitaire pour vérifier qu'une méthode déclenche une exception. Supposons qu'on veuille faire un test qui déclenche MyException dans la méthode myMethod(). La technique consiste à appeler la macro FAIL juste après myMethod(). Ainsi, si l'exception est déclenchée, la macro n'est pas appelée et le test passe. Il suffit alors de traiter l'exception dans un bloc catch. <br  />
</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">  myMethod();   <span class="comment">// doit déclencher mon exception...</span></div>
<div class="line">  FAIL;         <span class="comment">// ... si je suis ici c&#39;est que l&#39;exception n&#39;est pas déclenchée</span></div>
<div class="line">} <span class="keywordflow">catch</span> (<span class="keyword">const</span> MyException&amp; e) {</div>
<div class="line">  <span class="comment">// ok, l&#39;exception a été appelée</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Parfois la méthode ne lève pas une exception mais appelle la méthode TraceAccessor::fatal() du gestionnaire de traces de <a class="el" href="../../d0/d32/namespaceArcane.html" title="-*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-">Arcane</a> (cf. <a class="el" href="../../da/d65/arcanedoc_execution_traces.html">Utilisation des traces</a>). Cette méthode lève une exception de type Arcane::FatalErrorException qu'il suffit de traiter comme dans l'exemple ci-dessus.</p>
<h1><a class="anchor" id="arcanedoc_debug_perf_unit_tests_data"></a>
Le fichier de données</h1>
<p>Les tests unitaires s'exécutent grâce à un service et à une boucle en temps spécifiques fournis par Arcane. La seule chose à faire est de sélectionner la boucle en temps en question dans le fichier de données du code et d'ajouter votre service de test à la liste des services du module.</p>
<p>L'exemple ci-dessous montre un fichier de données type avec 'MonServiceDeTest' dans la liste des services de test.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">arcane</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">titre</span>&gt;<span class="keyword">Mon</span> <span class="keyword">cas</span> <span class="keyword">test</span>&lt;/<span class="keywordtype">titre</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">description</span>&gt;<span class="keyword">Description</span> <span class="keyword">de</span> <span class="keyword">mon</span> <span class="keyword">cas</span> <span class="keyword">test</span>&lt;/<span class="keywordtype">description</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">boucle-en-temps</span>&gt;<span class="keyword">UnitTest</span>&lt;/<span class="keywordtype">boucle-en-temps</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">arcane</span>&gt;</div>
<div class="line">...</div>
<div class="line">&lt;<span class="keywordtype">module-test-unitaire</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">xml-test</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MonServiceDeTest&quot;</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- ici les données de mon service de test (si bien sur il en a !)... --&gt;</span></div>
<div class="line">  &lt;/<span class="keywordtype">xml-test</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">module-test-unitaire</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="arcanedoc_debug_perf_unit_tests_run"></a>
L'exécution</h1>
<p>Il suffit alors d'exécuter votre programme comme d'habitude en lui donnant comme jeu de données, le fichier défini à l'étape précédente. Le module de test va alors effectuer une itération en déclenchant l'ensemble des méthodes de test des services fournis dans le fichier de données. Vous pourrez alors voir dans le listing la trace de l'exécution des tests comme ci-dessous.</p>
<p>On remarque que le listing signale également le chemin du rapport de test.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">*I-Master     *** ITERATION        1  TEMPS 1.000000000000000e+00  BOUCLE        1  DELTAT 1.000000000000000e+00 ***</div>
<div class="line">*I-Master     Date: 2013-05-28T14:52:28 Conso=(R=0,I=0,C=0) Mem=(62,m=62:0,M=62:0,avg=62)</div>
<div class="line">*I-UnitTest   [OK   ] myTestMethod1</div>
<div class="line">*I-UnitTest   [ECHEC] myTestMethod2 (line 136 in virtual void MonServiceDeTest::myTestMethod2())</div>
<div class="line">*I-UnitTest           Obtenu : 6.5. Attendu : 5.5.</div>
<div class="line">*I-UnitTest   [OK   ] myTestMethod3</div>
<div class="line">...</div>
<div class="line">*I-UnitTest   Sortie du rapport de test unitaire dans &#39;/tmp/moncas/output/listing/unittests.xml&#39;</div>
<div class="line">...</div>
</div><!-- fragment --><p>Le listing est un fichier XML. Il a le format suivant :</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">unit-tests-results</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">service</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MonServiceDeTest&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">unit-test</span> <span class="keyword">method-name</span>=<span class="stringliteral">&quot;Test 1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;myTestMethod1&quot;</span> <span class="keyword">result</span>=<span class="stringliteral">&quot;success&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">unit-test</span> <span class="keyword">method-name</span>=<span class="stringliteral">&quot;Test 2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;myTestMethod2&quot;</span> <span class="keyword">result</span>=<span class="stringliteral">&quot;failure&quot;</span>&gt;</div>
<div class="line">       &lt;<span class="keywordtype">exception</span> <span class="keyword">file</span>=<span class="stringliteral">&quot;/tmp/monprojet/src/MonServiceDeTest.cc&quot;</span> </div>
<div class="line">               <span class="keyword">line</span>=<span class="stringliteral">&quot;136&quot;</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;Obtenu : 6.5. Attendu : 5.5.&quot;</span></div>
<div class="line">     <span class="keyword">where</span>=<span class="stringliteral">&quot;virtual void MonServiceDeTest::myTestMethod2()&quot;</span> /&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">unit-test</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">unit-test</span> <span class="keyword">method-name</span>=<span class="stringliteral">&quot;Test 3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;myTestMethod3&quot;</span> <span class="keyword">result</span>=<span class="stringliteral">&quot;success&quot;</span> /&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">service</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">unit-tests-results</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="arcanedoc_debug_perf_unit_tests_own_timeloop"></a>
Utiliser sa propre boucle en temps</h1>
<p>Parfois, avant d'exécuter les tests unitaires, on aimerait effectuer des initialisations réalisées dans des points d'entrée des modules de l'application. Or, comme les tests unitaires sont exécutés dans une boucle en temps spécifique, ces points d'entrée ne sont pas appelés.</p>
<p>Pour contourner cela, il est possible de faire sa propre boucle en temps. Cette boucle en temps doit obligatoirement comporter les 3 points d'entrée suivants :</p>
<ul>
<li>UnitTest.UnitTestInit dans la section Init,</li>
<li>UnitTest.UnitTestDoTest dans la section ComputeLoop,</li>
<li>UnitTest.UnitTestExit dans la section Exit.</li>
</ul>
<p>Il faut penser à ajouter le module 'UnitTest' à la liste des modules de la boucle.</p>
<p>Il suffit alors d'insérer ses propres points d'entrée d'initialisation avant 'UnitTest.UnitTestInit'. La section 'ComputeLoop' ne comporte généralement que le point d'entrée 'UnitTest.UnitTestDoTest'.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">arcane-config</span> <span class="keyword">code-name</span>=<span class="stringliteral">&quot;MyCode&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">time-loops</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">time-loop</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MyTimeLoop&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">title</span>&gt;<span class="keyword">My</span> <span class="keyword">nice</span> <span class="keyword">timeloop</span>&lt;/<span class="keywordtype">title</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">modules</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UnitTest&quot;</span> <span class="keyword">need</span>=<span class="stringliteral">&quot;required&quot;</span> /&gt;</div>
<div class="line">        ...</div>
<div class="line">      &lt;/<span class="keywordtype">modules</span>&gt;</div>
<div class="line"> </div>
<div class="line">      &lt;<span class="keywordtype">entry-points</span> <span class="keyword">where</span>=<span class="stringliteral">&quot;init&quot;</span>&gt;</div>
<div class="line">        ...</div>
<div class="line">        &lt;<span class="keywordtype">entry-point</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UnitTest.UnitTestInit&quot;</span> /&gt; </div>
<div class="line">      &lt;/<span class="keywordtype">entry-points</span>&gt;</div>
<div class="line"> </div>
<div class="line">      &lt;<span class="keywordtype">entry-points</span> <span class="keyword">where</span>=<span class="stringliteral">&quot;compute-loop&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">entry-point</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UnitTest.UnitTestDoTest&quot;</span> /&gt; </div>
<div class="line">      &lt;/<span class="keywordtype">entry-points</span>&gt;</div>
<div class="line"> </div>
<div class="line">      &lt;<span class="keywordtype">entry-points</span> <span class="keyword">where</span>=<span class="stringliteral">&quot;exit&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">entry-point</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UnitTest.UnitTestExit&quot;</span> /&gt; </div>
<div class="line">      &lt;/<span class="keywordtype">entry-points</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">time-loop</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">time-loops</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">arcane-config</span>&gt;</div>
</div><!-- fragment --><p>Notons qu'il ne faut pas oublier de changer le nom de la boucle en temps dans le fichier de données !</p>
<hr  />
<div class="section_buttons"> <span class="back_section_button"> <a class="el" href="../../de/d33/arcanedoc_debug_perf_compare_bittobit.html">Comparaison bit à bit</a> </span> <span class="next_section_button"> <a class="el" href="../../d8/dcd/arcanedoc_debug_perf_cupti.html">Intégration avec CUPTI (Cuda Profiling Tools Interface)</a> </span> </div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
  <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <li class="navelem"><a class="el" href="../../index.html">%Arcane</a></li><li class="navelem"><a class="el" href="../../da/dc1/arcanedoc_debug_perf.html">Debug, performance et validation</a></li>
      <li class="footer">Généré le Lundi 11 Mars 2024 02:14:46 pour Arcane par <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
    </ul>
  </div>
  <script type="text/javascript" src="../../script-apply-config-theme.js"></script>
  <script type="text/javascript">
    // On met l'appel à cette fonction dans le footer dans le cas où
    // une page ne veut pas de personnalisation (changement de la 
    // variable globale "no_custom_theme").
    applyConfigWithCookies();
  </script>
</body>
</html>
