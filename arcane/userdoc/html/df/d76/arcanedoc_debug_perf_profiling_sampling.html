<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="../../logo_arcane.svg" type="image/svg+xml">
    <title>Arcane: Analyse de performances par échantillonage</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-custom.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../user_colors.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
    <script type="text/javascript" src="../../script-helper.js"></script>
    <script type="text/javascript" src="../../script-resize.js"></script>
    <script type="text/javascript" src="../../script-num-lines-code.js"></script>
    <script type="text/javascript" src="../../script-config-theme.js"></script>
    <script type="text/javascript" src="../../script-edit-config-theme.js"></script>
    <script type="text/javascript" src="../../script-alternative-theme.js"></script>
    <script type="text/javascript">
      // On demande l'activation de la personnalisation de la page.
      var no_custom_theme = false;
      DoxygenAwesomeDarkModeToggle.title = "Thème clair/sombre";
      DoxygenAwesomeDarkModeToggle.init();
      DoxygenAwesomeFragmentCopyButton.title = "Copier le code dans le presse-papier";
      DoxygenAwesomeFragmentCopyButton.init();
      DoxygenAwesomeParagraphLink.init();
      DoxygenAwesomeInteractiveToc.init();
      DoxygenAwesomeTabs.init()
      waitElemForResizeSideNav();
      setOldSize();
      //waitItemExpandCurrent();
    </script>
  </head>
  <body>
    <!--BEGIN CORNER_GITHUB-->
    <!-- https://tholman.com/github-corners/ -->
    <a href="https://github.com/arcaneframework/framework" class="github-corner" aria-label="Voir les sources sur GitHub">
      <svg width="70" height="70" viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <!--END CORNER_GITHUB-->
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectlogo">
                  <a href="../../index.html" title="Aller à la page principale">
                    <img alt="Logo" src="../../arcane_framework_small.webp" />
                  </a>
                </td>
              </tr>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">Arcane
                    <span id="projectnumber">&#160;v3.14.0.0</span>
                  </div>
                  <div id="projectbrief">Documentation utilisateur</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part -->
<!-- Généré par Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d76/arcanedoc_debug_perf_profiling_sampling.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Chargement...</div>
<div class="SRStatus" id="Searching">Recherche...</div>
<div class="SRStatus" id="NoMatches">Aucune correspondance</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Analyse de performances par échantillonage</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section warning"><dt>Avertissement</dt><dd>Actuellement, le profiling ne fonctionne que sur les plateformes Linux.</dd>
<dd>
Actuellement, le profiling NE FONCTIONNE PAS lorsque le multi-threading (que ce soit avec le mécanisme des tâches ou d'échange de message) est actif.</dd></dl>
<p>Le profiling dans Arcane fonctionne sur un principe d'échantillonage : à interval régulier, le code est interrompu et on regarde dans quelle méthode on se trouve. Si l'interval d'échantillonage est petit et si le code est exécuté pendant suffisamment longtemps, on obtient une bonne représentation statistique de la proportion de temps passé dans les méthodes les plus couteuses. Les méthodes par échantillonage ne nécessitent pas l'instrumentation du code et donc ralentissent très peu l'exécution. Par contre, elles ne permettent pas de savoir par exemple combien de fois une méthode est appelée, ni de connaitre facilement le graphe d'appel. Pour cela, il est nécessaire d'utiliser des mécanismes comme gprof avec le suppport du compilateur.</p>
<p>Pour activer le profiling, il faut positionner la variable d'environnement ARCANE_PROFILING avec une des valeurs suivantes:</p><ul>
<li><em>Prof</em> . Cela permet d'avoir un profiling peu précis mais qui fonctionne sur toutes les machines Linux. L'échantillonage est d'une fréquence de l'ordre de 20Hz et donc il faut faire tourner le code au moins 1 minutes pour avoir des résultats significatifs</li>
<li><em>Papi</em>. Cela permet d'avoir un profiling très précis, utilisant les compteurs hardware du processeur. On utilise pour cela la bibliothèque libre PAPI. Cela ne fonctionne qu'avec les noyaux Linux récents (2.6.32 ou +) ou les noyaux patchés et il faut que Arcane soit compilé avec ce support. Dans ce mode l'échantillonage est donnée en nombre de cycles d'horloge du processeur. La valeur par défaut est de 500000 cycles. Pour un processeur à 3GHz, cela fait donc 6000 échantillons par seconde. Il est possible de changer le nombre de cycles via la variable d'environnement ARCANE_PROFILING_PERIOD. Il est préférable de ne pas descendre en dessous de la valeur par défaut.</li>
</ul>
<p>Afin de garder des performances raisonnables lors de l'exécution, il est préférable de ne pas dépasser 100000 échantillons. Il faut donc ajuster la durée d'exécution du test ou la fréquence d'échantillonage en fonction de cela.</p>
<p>Lorsqu'il est actif, le profiling commence à la première itération et s'arrête à la dernière itération de l'exécution. En parallèle, le profiling se fait pour chaque processeur et Arcane affiche alors dans le listing de chaque processeur les informations de profiling de la manière suivante :</p>
<div class="fragment"><div class="line">*I-Internal    PROCESS_ID = 17977</div>
<div class="line">*I-Internal    NB ADDRESS MAP = 737</div>
<div class="line">*I-Internal    NB FUNC MAP = 53</div>
<div class="line">*I-Internal    NB STACK MAP = 0</div>
<div class="line">*I-Internal    TOTAL STACK = 0</div>
<div class="line">*I-Internal    FUNC EVENT=2798</div>
<div class="line">*I-Internal    FUNC FP=0</div>
<div class="line">*I-Internal    TOTAL EVENT  = 2799</div>
<div class="line">*I-Internal    TOTAL FP     = 1 (nb_giga_flip=0.0005)</div>
<div class="line">*I-Internal    RATIO FP/CYC = 0.000357270453733476</div>
<div class="line">*I-Internal    event     %   function</div>
<div class="line">*I-Internal      1113   39.7      1113      0      0 0  SimpleHydro::ModuleSimpleHydro::computeCQs(Arcane::Real3*, Arcane::Real3*, Arcane::Cell const&amp;)</div>
<div class="line">*I-Internal       613   21.9       613      0      0 0  SimpleHydro::ModuleSimpleHydro::_computeGeometricValues(Arcane::ItemVectorViewT&lt;Arcane::Cell&gt;)</div>
<div class="line">*I-Internal       396   14.1       396      0      0 0  SimpleHydro::ModuleSimpleHydro::_computePressureAndCellPseudoViscosityForces()</div>
<div class="line">*I-Internal       217    7.7       217      0      0 0  SimpleHydro::ModuleSimpleHydro::_applyEquationOfState(Arcane::ItemVectorViewT&lt;Arcane::Cell&gt;)</div>
<div class="line">*I-Internal        87    3.1        87      0      0 0  SimpleHydro::ModuleSimpleHydro::applyBoundaryCondition()</div>
<div class="line">*I-Internal        85    3.0        85      0      0 0  SimpleHydro::ModuleSimpleHydro::_computeViscosityWork(Arcane::ItemVectorViewT&lt;Arcane::Cell&gt;)</div>
<div class="line">*I-Internal        77    2.7        77      0      0 0  SimpleHydro::ModuleSimpleHydro::updateDensity()</div>
<div class="line">*I-Internal        70    2.5        70      0      0 0  SimpleHydro::ModuleSimpleHydro::computeVelocity()</div>
<div class="line">*I-Internal        50    1.7        50      0      0 0  SimpleHydro::ModuleSimpleHydro::computeDeltaT()</div>
<div class="line">*I-Internal        28    1.0        28      0      0 0  SimpleHydro::ModuleSimpleHydro::moveNodes()</div>
<div class="line">*I-Internal        13    0.4        13      0      0 0  Arcane::VariableArrayT&lt;Arcane::Real3&gt;::fill(Arcane::Real3 const&amp;, Arcane::ItemGroup const&amp;)</div>
<div class="line">*I-Internal         4    0.1         4      0      0 0  _IO_vfprintf</div>
<div class="line">*I-Internal         2    0.0         2      0      0 0  Arcane::Timer::Sentry::~Sentry()</div>
<div class="line">*I-Internal         1    0.0         1      0      0 0  SimpleHydro::ModuleSimpleHydro::applyEquationOfState()</div>
</div><!-- fragment --><p>Les premières lignes sont des informations internes à Arcane. Ensuite, est affiché, par ordre décroissant du temps passé, chaque méthode. Dans l'exemple précédent, on voit qu'on passe 39.7% du temps dans la méthode ModuleSimpleHydro::computeCQs().</p>
<p>Pour que les résultats soient pertinents, il faut que le code soit compilé en mode optimisé avec l'inlining activé.</p>
<hr  />
<div class="section_buttons"> <span class="back_section_button"> <a class="el" href="../../dd/d47/arcanedoc_debug_perf_profiling.html">Profiling</a> </span> <span class="next_section_button"> <a class="el" href="../../d8/de3/arcanedoc_debug_perf_profiling_mpi.html">Analyse de performances par instrumentation interne</a> </span> </div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
  <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <li class="navelem"><a class="el" href="../../index.html">%Arcane</a></li><li class="navelem"><a class="el" href="../../da/dc1/arcanedoc_debug_perf.html">Debug, performance et validation</a></li><li class="navelem"><a class="el" href="../../dd/d47/arcanedoc_debug_perf_profiling.html">Profiling</a></li>
      <li class="footer">Généré le Lundi 22 Juillet 2024 02:43:18 pour Arcane par <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
    </ul>
  </div>
  <script type="text/javascript" src="../../script-apply-config-theme.js"></script>
  <script type="text/javascript">
    // On met l'appel à cette fonction dans le footer dans le cas où
    // une page ne veut pas de personnalisation (changement de la 
    // variable globale "no_custom_theme").
    applyConfigWithCookies();
  </script>
</body>
</html>
